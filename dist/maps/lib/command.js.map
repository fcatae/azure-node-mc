{"version":3,"sources":["lib/command.js"],"names":[],"mappings":"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","file":"lib/command.js","sourcesContent":["class Command {\n  constructor(params, parent, hash) {\n    this.params = params;\n    this.parent = parent;\n    this.hash = parent ? parent.hash : {};\n    this.uniqueHash = parent ? parent.uniqueHash : {};\n    this.parentBase = (this.parent && this.parent.base && this.parent.base + ' ') || '';\n    this.base = this.parentBase + (this.params.base || '');\n\n    if(this.params.base) this.updateHistory();\n  }\n\n  find(command) {\n    const parts=command.split(\" \");\n    const c=parts.shift();\n    const pars=parts.join(\" \");\n    if(this.hash[c])\n      return [this.hash[c], pars];\n    return undefined;\n  }\n\n  async use(command, op=true) {\n    let res = this.find(command);\n\n    if(res) {\n      let [com,pars]=res;\n      if (com.params.op && !op) return 'You do not have permission to use this command';\n      const parse = com.params.parse;\n      if(parse) {\n        if(typeof parse == 'function') {\n          pars = parse(pars);\n          if(pars === false) {\n            return com.params.usage ? 'Usage: ' + com.params.usage : 'Bad syntax';\n          }\n        } else {\n          pars = pars.match(parse);\n        }\n      }\n      \n      res = await com.params.action(pars);\n\n      if(res) return '' + res;\n    } else {\n      return 'Command not found';\n    }\n  }\n\n  updateHistory() {\n    const all = '(.+?)';\n\n    const list = [this.base];\n    if(this.params.aliases && this.params.aliases.length) {\n      this.params.aliases.forEach(al => list.unshift(this.parentBase + al));\n    }\n\n    list.forEach((command) => {\n      const parentBase = this.parent ? (this.parent.path || '') : '';\n      this.path = parentBase + this.space() + (command || all);\n      if(this.path == all && !this.parent) this.path = '';\n\n      if(this.path) this.hash[this.path] = this;\n    });\n    this.uniqueHash[this.base] = this;\n  }\n\n  add(params) {\n    return new Command(params, this);\n  }\n\n  space(end) {\n    const first = !(this.parent && this.parent.parent);\n    return this.params.merged || (!end && first) ? '' : ' ';\n  }\n\n  setOp(op) {\n    this.params.op = op;\n  }\n}\n\nmodule.exports=Command;"],"sourceRoot":"/source/"}