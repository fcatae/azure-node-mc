{"version":3,"sources":["lib/plugins/chat.js"],"names":[],"mappings":"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","file":"lib/plugins/chat.js","sourcesContent":["module.exports.server=function(serv)\n{\n  serv.broadcast = (message, {whitelist=serv.players,blacklist=[],system=false}={}) => {\n    if (whitelist.type == 'player') whitelist = [whitelist];\n\n    if (typeof message == 'string') message = serv.parseClassic(message);\n\n    whitelist.filter(w => blacklist.indexOf(w) == -1).forEach(player => {\n      if (!system) player.chat(message);\n      else player.system(message);\n    });\n  };\n\n  serv.color = {\n    'black': '&0',\n    'dark_blue': '&1',\n    'dark_green': '&2',\n    'dark_cyan': '&3',\n    'dark_red': '&4',\n    'purple': '&5',\n    'dark_purple': '&5',\n    'gold': '&6',\n    'gray': '&7',\n    'grey': '&7',\n    'dark_gray': '&8',\n    'dark_grey': '&8',\n    'blue': '&9',\n    'green': '&a',\n    'aqua': '&b',\n    'cyan': '&b',\n    'red': '&c',\n    'pink': '&d',\n    'light_purple': '&d',\n    'yellow': '&e',\n    'white': '&f',\n    'random': '&k',\n    'obfuscated': '&k',\n    'bold': '&l',\n    'strikethrough': '&m',\n    'underlined': '&n',\n    'underline': '&n',\n    'italic': '&o',\n    'italics': '&o',\n    'reset': '&r'\n  };\n\n  serv.parseClassic = (message) => {\n    if (typeof message == 'object') return message;\n    const messageList = [];\n    let text = '';\n    let nextChanged = false;\n    let color = 'white';\n    let bold = false;\n    let italic = false;\n    let underlined = false;\n    let strikethrough = false;\n    let random = false;\n    const colors = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f', 'k','l','m','n','o','r','&'];\n    const convertColor = ['black', 'dark_blue','dark_green','dark_cyan','dark_red','dark_purple','gold',\n                        'gray', 'dark_gray', 'blue', 'green', 'aqua', 'red', 'light_purple', 'yellow', 'white',\n                        'random', 'bold', 'strikethrough', 'underlined', 'italic', 'reset', '&'];\n\n    function createJSON() {\n      if (!text.trim()) return;\n      messageList.push({\n        text: text,\n        color: color,\n        bold: bold,\n        italic: italic,\n        underlined: underlined,\n        strikethrough: strikethrough,\n        obfuscated: random\n      });\n      text = '';\n    }\n\n    while (message != '') {\n      const currChar = message[0];\n      if (nextChanged) {\n        const newColor = convertColor[colors.indexOf(currChar)];\n        if (newColor) {\n          if (newColor == 'bold') bold = true;\n          else if (newColor == 'strikethrough') strikethrough = true;\n          else if (newColor == 'underlined') underlined = true;\n          else if (newColor == 'italic') italic = true;\n          else if (newColor == 'random') random = true;\n          else if (newColor == '&') text += '&';\n          else if (newColor == 'reset') {\n            strikethrough = false;\n            bold = false;\n            underlined = false;\n            random = false;\n            italic = false;\n            color = 'white';\n          } else color = newColor;\n        }\n        nextChanged = false;\n      } else if (currChar == '&') {\n        if (nextChanged) {\n          text += '&';\n          nextChanged = false;\n        } else {\n          nextChanged = true;\n          createJSON();\n        }\n      } else {\n        text += currChar;\n      }\n\n      message = message.slice(1, message.length);\n    }\n    createJSON();\n\n    if (messageList.length > 0) return {\n      text: '',\n      extra: messageList\n    };\n    else return { text: '' }\n  }\n};\n\nmodule.exports.player=function(player,serv)\n{\n  player._client.on('chat', ({message} = {}) => {\n    if(message[0]==\"/\") {\n      player.behavior('command', {command: message.slice(1)}, ({command}) => player.handleCommand(command));\n    }\n    else {\n      player.behavior('chat', {\n        message: message,\n        prefix: '<' + player.username + '> ',\n        text: message,\n        whitelist: serv.players,\n        blacklist: []\n      }, ({prefix, text, whitelist, blacklist}) => {\n        const obj = serv.parseClassic(prefix);\n        if (!obj.extra) obj.extra = [];\n        obj.extra.push(serv.parseClassic(text));\n        serv.broadcast(obj, {\n          whitelist: whitelist,\n          blacklist: blacklist\n        });\n      });\n    }\n  });\n\n  player.chat = message => {\n    if (typeof message == 'string') message = serv.parseClassic(message);\n    player._client.write('chat', { message: JSON.stringify(message), position: 0 });\n  };\n\n  player.emptyChat = (count=1) => {\n    for (let i = 0; i < count; i++) {\n      player.chat('');\n    }\n  };\n\n  player.system = message => {\n    if (typeof message == 'string') message = serv.parseClassic(message);\n    player._client.write('chat', { message: JSON.stringify(message), position: 2 });\n  };\n};"],"sourceRoot":"/source/"}