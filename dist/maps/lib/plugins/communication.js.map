{"version":3,"sources":["lib/plugins/communication.js"],"names":[],"mappings":"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","file":"lib/plugins/communication.js","sourcesContent":["module.exports.server=function(serv)\n{\n  serv._writeAll= (packetName, packetFields) =>\n    serv.players.forEach((player) => player._client.write(packetName, packetFields));\n\n  serv._writeArray= (packetName, packetFields, players) =>\n    players.forEach((player) =>player._client.write(packetName, packetFields));\n\n  serv._writeNearby= (packetName, packetFields, loc) =>\n    serv._writeArray(packetName, packetFields, serv.getNearby(loc));\n\n  serv.getNearby= ({world,position,radius=8*16*32}) => serv.players.filter( player =>\n    player.world == world &&\n    player.position.distanceTo(position) <= radius\n  );\n\n  serv.getNearbyEntities= ({world,position,radius=8*16*32}) => Object.keys(serv.entities)\n    .map(eId => serv.entities[eId])\n    .filter(entity =>\n      entity.world == world &&\n      entity.position.distanceTo(position) <= radius\n    );\n};\n\nmodule.exports.entity=function(entity,serv)\n{\n  \n  entity.getNearby = () => serv\n    .getNearbyEntities({\n      world: entity.world,\n      position: entity.position,\n      radius: entity.viewDistance*32\n    })\n    .filter((e) => e != entity);\n\n  entity.getOtherPlayers = () => serv.players.filter((p) => p != entity);\n\n  entity.getOthers = () => serv.entities.filter((e) => e != entity);\n\n  entity.getNearbyPlayers = (radius=entity.viewDistance*32) => entity.getNearby()\n    .filter((e) => e.type == 'player');\n\n  entity.nearbyPlayers = (radius=entity.viewDistance*32) => entity.nearbyEntities\n    .filter(e => e.type == 'player');\n\n  entity._writeOthers = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getOtherPlayers());\n\n  entity._writeOthersNearby = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getNearbyPlayers());\n\n  entity._writeNearby = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getNearbyPlayers().concat(entity.type == 'player' ? [entity] : []));\n};"],"sourceRoot":"/source/"}