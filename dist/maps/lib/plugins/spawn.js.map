{"version":3,"sources":["lib/plugins/spawn.js"],"names":[],"mappings":"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","file":"lib/plugins/spawn.js","sourcesContent":["const version = require(\"flying-squid\").version;\nconst entitiesByName=require(\"minecraft-data\")(version).entitiesByName;\nconst entitiesById=require(\"minecraft-data\")(version).entities;\nconst Entity = require(\"prismarine-entity\");\nconst path = require('path');\nconst requireIndex = require('requireindex');\nconst plugins = requireIndex(path.join(__dirname,'..', 'plugins'));\nconst Item = require(\"prismarine-item\")(version);\nconst UserError = require('flying-squid').UserError;\n\nconst Vec3 = require(\"vec3\").Vec3;\n\nmodule.exports.server=function(serv,options) {\n  serv.initEntity = (type, entityType, world, position) => {\n    serv.entityMaxId++;\n    const entity = new Entity(serv.entityMaxId);\n\n    Object.keys(plugins)\n      .filter(pluginName => plugins[pluginName].entity!=undefined)\n      .forEach(pluginName => plugins[pluginName].entity(entity, serv, options));\n\n    entity.initEntity(type, entityType, world, position);\n\n    serv.emit(\"newEntity\",entity);\n\n    return entity;\n  };\n\n  serv.spawnObject = (type, world, position, {pitch=0,yaw=0,velocity=new Vec3(0,0,0),data=1,itemId,itemDamage=0,pickupTime=undefined,deathTime=undefined}) => {\n    const object = serv.initEntity('object', type, world, position.scaled(32).floored());\n    object.data = data;\n    object.velocity = velocity.scaled(32).floored();\n    object.pitch = pitch;\n    object.yaw = yaw;\n    object.gravity = new Vec3(0, -20*32, 0);\n    object.terminalvelocity = new Vec3(27*32, 27*32, 27*32);\n    object.friction = new Vec3(15*32, 0, 15*32);\n    object.size = new Vec3(0.25*32, 0.25*32, 0.25*32); // Hardcoded, will be dependent on type!\n    object.deathTime = deathTime;\n    object.pickupTime = pickupTime;\n    object.itemId = itemId;\n    object.itemDamage = itemDamage;\n\n    object.updateAndSpawn();\n  };\n\n  serv.spawnMob = (type, world, position, {pitch=0,yaw=0,headPitch=0,velocity=new Vec3(0,0,0),metadata=[]}={}) => {\n    const mob = serv.initEntity('mob', type, world, position.scaled(32).floored());\n    mob.name=entitiesById[type].name;\n    mob.velocity = velocity.scaled(32).floored();\n    mob.pitch = pitch;\n    mob.headPitch = headPitch;\n    mob.yaw = yaw;\n    mob.gravity = new Vec3(0, -20*32, 0);\n    mob.terminalvelocity = new Vec3(27*32, 27*32, 27*32);\n    mob.friction = new Vec3(15*32, 0, 15*32);\n    mob.size = new Vec3(0.75, 1.75, 0.75);\n    mob.health = 20;\n    mob.metadata = metadata;\n\n    mob.updateAndSpawn();\n    return mob;\n  };\n\n  serv.destroyEntity = entity => {\n    entity._writeOthersNearby('entity_destroy', {\n      entityIds: [entity.id]\n    });\n    delete serv.entities[entity.id];\n  };\n};\n\n\nmodule.exports.player=function(player,serv){\n  player.commands.add({\n    base: 'spawn',\n    info: 'Spawn a mob',\n    usage: '/spawn <entity_id>',\n    op: true,\n    parse(str) {\n      const results=str.match(/(\\d+)/);\n      if (!results) return false;\n      return {\n        id: parseInt(results[1])\n      }\n    },\n    action({id}) {\n      serv.spawnMob(id, player.world, player.position.scaled(1/32), {\n        velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n      });\n    }\n  });\n\n  player.commands.add({\n    base: 'spawnObject',\n    info: 'Spawn an object',\n    usage: '/spawnObject <entity_id>',\n    op: true,\n    parse(str) {\n      const results=str.match(/(\\d+)/);\n      if (!results) return false;\n      return {\n        id: parseInt(results[1])\n      }\n    },\n    action({id}) {\n      serv.spawnObject(id, player.world, player.position.scaled(1/32), {\n        velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n      });\n    }\n  });\n\n  player.commands.add({\n    base: 'summon',\n    info: 'Summon an entity',\n    usage: '/summon <entity_name>',\n    op: true,\n    action(name) {\n      const entity=entitiesByName[name];\n      if(!entity) {\n        player.chat(\"No entity named \"+name);\n        return;\n      }\n      serv.spawnMob(entity.id, player.world, player.position.scaled(1/32), {\n        velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n      });\n    }\n  });\n\n  player.commands.add({\n    base: 'summonMany',\n    info: 'Summon many entities',\n    usage: '/summonMany <number> <entity_name>',\n    op: true,\n    parse(str) {\n      var args=str.split(\" \");\n      if(args.length!=2)\n        return false;\n      return {number:args[0],name:args[1]};\n    },\n    action({number,name}) {\n      const entity=entitiesByName[name];\n      if(!entity) {\n        player.chat(\"No entity named \"+name);\n        return;\n      }\n      let s=Math.floor(Math.sqrt(number));\n      for(let i=0;i<number;i++)\n        serv.spawnMob(entity.id, player.world, player.position.scaled(1/32).offset(Math.floor(i/s*10),0,i%s*10), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n        });\n    }\n  });\n\n  player.commands.add({\n    base: 'pile',\n    info: 'make a pile of entities',\n    usage: '/pile <entities types>',\n    op: true,\n    parse(str)  {\n      const args=str.split(' ');\n      if(args.length==0)\n        return false;\n      return args\n        .map(name => entitiesByName[name])\n        .filter(entity => !!entity);\n    },\n    action(entityTypes) {\n      entityTypes.map(entity =>\n        serv.spawnMob(entity.id, player.world, player.position.scaled(1/32), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n        }))\n        .reduce((prec,entity) => {\n          if(prec!=null)\n            prec.attach(entity);\n          return entity;\n        },null);\n    }\n  });\n\n  player.commands.add({\n    base: 'attach',\n    info: 'attach an entity on an other entity',\n    usage: '/attach <carrier> <attached>',\n    op: true,\n    parse(str)  {\n      const args=str.split(' ');\n      if(args.length!=2)\n        return false;\n\n      let carrier = player.selectorString(args[0]);\n      if(carrier.length==0) throw new UserError(\"one carrier\");\n      let attached = player.selectorString(args[1]);\n      if(attached.length==0) throw new UserError(\"one attached\");\n\n      return {carrier:carrier[0],attached:attached[0]};\n    },\n    action({carrier,attached}) {\n      carrier.attach(attached);\n    }\n  });\n\n\n  player.spawnEntity = entity => {\n    player._client.write(entity.spawnPacketName, entity.getSpawnPacket());\n    if (typeof entity.itemId != 'undefined') {\n      entity.sendMetadata([{\n        \"key\": 10,\n        \"type\": 5,\n        \"value\": {\n          blockId: entity.itemId,\n          itemDamage: entity.itemDamage,\n          itemCount:1\n        }\n      }]);\n    }\n    entity.equipment.forEach((equipment,slot) => {\n        if (equipment != undefined) player._client.write(\"entity_equipment\", {\n          entityId: entity.id,\n          slot: slot,\n          item: Item.toNotch(equipment)\n        });\n      }\n    )\n  };\n};\n\nmodule.exports.entity=function(entity,serv) {\n  entity.initEntity=(type, entityType, world, position)=>{\n    entity.type = type;\n    entity.spawnPacketName = '';\n    entity.entityType = entityType;\n    entity.world = world;\n    entity.position = position;\n    entity.lastPositionPlayersUpdated = entity.position.clone();\n    entity.nearbyEntities = [];\n    entity.viewDistance = 150;\n    entity.score = {};\n\n    entity.bornTime = Date.now();\n    serv.entities[entity.id] = entity;\n\n    if (entity.type == 'player') entity.spawnPacketName = 'named_entity_spawn';\n    else if (entity.type == 'object') entity.spawnPacketName = 'spawn_entity';\n    else if (entity.type == 'mob') entity.spawnPacketName = 'spawn_entity_living';\n  };\n\n  entity.getSpawnPacket = () => {\n    const scaledVelocity = entity.velocity.scaled(8000/32/20).floored(); // from fixed-position/second to unit => 1/8000 blocks per tick\n    if (entity.type == 'player') {\n      return {\n        entityId: entity.id,\n        playerUUID: entity._client.uuid,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        yaw: entity.yaw,\n        pitch: entity.pitch,\n        currentItem: 0,\n        metadata: entity.metadata\n      }\n    } else if (entity.type == 'object') {\n      return {\n        entityId: entity.id,\n        type: entity.entityType,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        pitch: entity.pitch,\n        yaw: entity.yaw,\n        objectData: {\n          intField: entity.data,\n          velocityX: scaledVelocity.x,\n          velocityY: scaledVelocity.y,\n          velocityZ: scaledVelocity.z\n        }\n      }\n    } else if (entity.type == 'mob') {\n      return {\n        entityId: entity.id,\n        type: entity.entityType,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        yaw: entity.yaw,\n        pitch: entity.pitch,\n        headPitch: entity.headPitch,\n        velocityX: scaledVelocity.x,\n        velocityY: scaledVelocity.y,\n        velocityZ: scaledVelocity.z,\n        metadata: entity.metadata\n      }\n    }\n  };\n\n\n\n  entity.updateAndSpawn = () => {\n    const updatedEntities=entity.getNearby();\n    const entitiesToAdd=updatedEntities.filter(e => entity.nearbyEntities.indexOf(e)==-1);\n    const entitiesToRemove=entity.nearbyEntities.filter(e => updatedEntities.indexOf(e)==-1);\n    if (entity.type == 'player') {\n      entity.despawnEntities(entitiesToRemove);\n      entitiesToAdd.forEach(entity.spawnEntity);\n    }\n    entity.lastPositionPlayersUpdated=entity.position.clone();\n\n    const playersToAdd = entitiesToAdd.filter(e => e.type == 'player');\n    const playersToRemove = entitiesToRemove.filter(e => e.type == 'player');\n\n    playersToRemove.forEach(p => p.despawnEntities([entity]));\n    playersToRemove.forEach(p => p.nearbyEntities=p.getNearby());\n    playersToAdd.forEach(p => p.spawnEntity(entity));\n    playersToAdd.forEach(p => p.nearbyEntities=p.getNearby());\n\n    entity.nearbyEntities=updatedEntities;\n  };\n\n\n  entity.on(\"move\",() => {\n    if(entity.position.distanceTo(entity.lastPositionPlayersUpdated)>2*32)\n      entity.updateAndSpawn();\n  });\n\n  entity.destroy = () => {\n    serv.destroyEntity(entity);\n  };\n\n  entity.attach= (attachedEntity,leash=false) =>\n  {\n    const p={\n      entityId:attachedEntity.id,\n      vehicleId:entity.id,\n      leash:leash\n    };\n    if(entity.type=='player')\n      entity._client.write('attach_entity',p);\n    entity._writeOthersNearby('attach_entity',p);\n  }\n\n};"],"sourceRoot":"/source/"}