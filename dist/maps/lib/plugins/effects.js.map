{"version":3,"sources":["lib/plugins/effects.js"],"names":[],"mappings":"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","file":"lib/plugins/effects.js","sourcesContent":["\nmodule.exports.entity = function(entity, serv) {\n  entity.effects = {};\n  for (let i = 1; i <= 23; i++) { // 23 in 1.8, 27 in 1.9\n    entity.effects[i] = null; // Just so we know it's a real potion and not undefined/not existant\n  }\n\n  entity.sendEffect = (effectId, {amplifier=0,duration=30*20,particles=true,whitelist,blacklist=[]}={}) => {\n    if (!whitelist) whitelist = serv.getNearby(entity);\n    if (entity.type == 'player' && [1].indexOf(effectId) != -1) entity.sendAbilities();\n    const sendTo = whitelist.filter(p => blacklist.indexOf(p) == -1);\n    const data = {\n      entityId: entity.id,\n      effectId: effectId,\n      amplifier: amplifier,\n      duration: duration,\n      hideParticles: !particles\n    };\n    serv._writeArray('entity_effect', data, sendTo);\n  };\n\n  entity.sendRemoveEffect = (effectId, {whitelist,blacklist=[]}={}) => {\n    if (!whitelist) whitelist = serv.getNearby(entity);\n    const sendTo = whitelist.filter(p => blacklist.indexOf(p) == -1);\n    serv._writeArray('remove_entity_effect', {\n      entityId: entity.id,\n      effectId: effectId\n    }, sendTo);\n  };\n\n  entity.addEffect = (effectId, opt={}) => {\n    const amp = typeof opt.amplifier == 'undefined' ? 0 : opt.amplifier;\n    if (!entity.effects[effectId] || opt.override || amp < entity.effects[effectId].amplifier) {\n      entity.effects[effectId] = {\n        amplifier: opt.amplifier || 0,\n        duration: opt.duration || 30*20,\n        particles: opt.particles || true,\n        end: Date.now() + (opt.duration || 30*20)*1000/20, // 1000/20 == convert from ticks to milliseconds,\n        timeout:setTimeout(() => entity.removeEffect(effectId),(opt.duration || 30*20)*1000/20)\n      };\n      entity.sendEffect(effectId, opt);\n      return true;\n    } else return false;\n  };\n\n  entity.removeEffect = (effectId, opt) => {\n    clearTimeout(entity.effects[effectId].timeout);\n    entity.effects[effectId] = null;\n    entity.sendRemoveEffect(effectId, opt);\n  };\n};\n\nmodule.exports.player = function(player) {\n  player.commands.add({\n    base: 'effect',\n    info: 'Give player an effect',\n    usage: '/effect <player> <effect> [seconds] [amplifier] [hideParticles]',\n    parse(str) {\n      return str.match(/(.+?) (\\d+)(?: (\\d+))?(?: (\\d+))?(?: (true|false))?|.*? clear/) || false;\n    },\n    action(params) {\n      const targets = player.selectorString(params[1]);\n      if (params[2] == 'clear') {\n        targets.forEach(e => Object.keys(e.effects).forEach(effectId => {\n          if (e.effects[effectId] != null) e.removeEffect(effectId);\n        }));\n      } else {\n        targets.forEach(e => {\n          const effId = parseInt(params[2]);\n          if (e.effects[effId]) {\n            e.removeEffect(effId);\n          }\n          e.addEffect(effId, {\n            amplifier: parseInt(params[4]) || 0,\n            duration: parseInt(params[3]) * 20 || 30 * 20,\n            particles: params[5] != 'true' // hidesParticles vs particles (i.e. \"showParticles\")\n          });\n        });\n      }\n      const chatSelect = (targets.length == 1 ? (targets[0].type == 'player' ? targets[0].username : 'entity') : 'entities');\n      if (params[2] == 'clear') player.chat('Remove all effects from ' + chatSelect + '.' );\n      else player.chat('Gave ' + chatSelect + ' effect ' + params[2] + '(' + (params[4] || 0) + ') for ' + \n                        (parseInt(params[3]) || 30) + ' seconds');\n    }\n  });\n};"],"sourceRoot":"/source/"}