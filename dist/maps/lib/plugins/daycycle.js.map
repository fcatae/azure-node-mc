{"version":3,"sources":["lib/plugins/daycycle.js"],"names":[],"mappings":"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","file":"lib/plugins/daycycle.js","sourcesContent":["module.exports.server=function(serv) {\n  serv.setTime = (time) => {\n    serv.time = time;\n    serv._writeAll('update_time', {\n      age: [0, 0], // TODO\n      time: [0, serv.time]\n    });\n  };\n\n  serv.doDaylightCycle = true;\n\n  serv.time = 0;\n\n  serv.on('tick', (delta,count) => {\n    if (!serv.doDaylightCycle) return;\n    if (count % 20 == 0) {\n      serv.behavior('changeTime', {\n        old: serv.time,\n        newTime: serv.time + 20\n      }, ({newTime}) => {\n        serv.setTime(newTime % 24000); // Vanilla only does it every second\n      });\n    }\n  })\n};\n\nmodule.exports.player=function(player,serv){\n  player.commands.add({\n    base: 'night',\n    info: 'to change a time to night',\n    usage: '/night',\n    op: true,\n    action() {\n      return player.handleCommand('time set night');\n    }\n  });\n\n  player.commands.add({\n    base: 'time',\n    info: 'to change a time',\n    usage: '/time <add|query|set> <value>',\n    op: true,\n    parse(str) {\n      const data = str.match(/^(add|query|set)(?: ([0-9]+|day|night))?/);\n      if(!data) return false;\n      return {\n        action: data[1],\n        value: data[2] == 'day' ? 1000 : (data[2] == 'night' ? 13000 : parseInt(data[2]))\n      };\n    },\n    action({action,value}) {\n      if(action == \"query\") {\n        player.chat(\"It is \"+serv.time);\n      } else {\n        let newTime;\n\n        if(action == \"set\") {\n          newTime = value;\n        } else if(action == \"add\") {\n          newTime = value + serv.time;\n        }\n\n        player.chat(\"Time was changed from \" + serv.time + \" to \" + newTime);\n        serv.setTime(newTime);\n      }\n    }\n  });\n\n  player.commands.add({\n    base: 'day',\n    info: 'to change a time to day',\n    usage: '/day',\n    op: true,\n    action() {\n      return player.handleCommand('time set day');\n    }\n  });\n};"],"sourceRoot":"/source/"}