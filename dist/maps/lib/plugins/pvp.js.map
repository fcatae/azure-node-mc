{"version":3,"sources":["lib/plugins/pvp.js"],"names":[],"mappings":"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","file":"lib/plugins/pvp.js","sourcesContent":["const Vec3 = require(\"vec3\").Vec3;\nconst UserError = require('flying-squid').UserError;\n\nmodule.exports.player=function(player,serv)\n{\n\n  player.updateHealth = (health) => {\n    player.health = health;\n    player._client.write('update_health', {\n      food: player.food,\n      foodSaturation: 0.0,\n      health: player.health\n    });\n  };\n\n  function attackEntity(entityId) \n  {\n    const attackedEntity = serv.entities[entityId];\n    if(!attackedEntity || (attackedEntity.gameMode != 0 && attackedEntity.type == 'player')) return;\n\n    player.behavior('attack', {\n      attackedEntity: attackedEntity,\n      velocity: attackedEntity.position.minus(player.position).plus(new Vec3(0, 0.5, 0)).scaled(5)\n    }, (o) => o.attackedEntity.takeDamage(o));\n  }\n\n  player._client.on(\"use_entity\", ({mouse,target} = {}) => {\n    if(!serv.entities[target])\n    {\n      let dragon;\n      for(dragon=target-1;dragon>=target-7 && !serv.entities[dragon];dragon--){}\n      if(serv.entities[dragon] && serv.entities[dragon].entityType==63)\n         target=dragon;\n    }\n    if(mouse == 1)\n      attackEntity(target);\n  });\n\n  player.commands.add({\n    base: 'kill',\n    info: 'Kill entities',\n    usage: '/kill <selector>',\n    op: true,\n    parse(str) {\n      return str || false;\n    },\n    action(sel) {\n      let arr = player.selectorString(sel);\n      if (arr.length==0) throw new UserError('Could not find player');\n\n      arr.map(entity => entity.takeDamage({damage:20}));\n    }\n  });\n\n};\n\nmodule.exports.entity=function(entity,serv)\n{\n  entity.takeDamage=({sound='game.player.hurt', damage=1, velocity=new Vec3(0,0,0), maxVelocity=new Vec3(4, 4, 4), animation=true}) => {\n    entity.updateHealth(entity.health - damage);\n    serv.playSound(sound, entity.world, entity.position.scaled(1/32));\n\n    entity.sendVelocity(velocity.scaled(1/32), maxVelocity);\n\n    if(entity.health<=0) {\n      if(animation)\n        entity._writeOthers('entity_status', {\n          entityId: entity.id,\n          entityStatus: 3\n        });\n      if(entity.type!=\"player\")\n        delete serv.entities[entity.id];\n    }\n    else if (animation)\n      entity._writeOthers('animation',{\n        entityId:entity.id,\n        animation:1\n      });\n  };\n\n  if (entity.type != 'player') {\n    entity.updateHealth = (health) => {\n      entity.health = health;\n    }\n  }\n};"],"sourceRoot":"/source/"}