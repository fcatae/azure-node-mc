{"version":3,"sources":["lib/plugins/particle.js"],"names":[],"mappings":"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","file":"lib/plugins/particle.js","sourcesContent":["const Vec3 = require(\"vec3\").Vec3;\n\nmodule.exports.server=function(serv) {\n  serv.emitParticle = (particle, world, position, {whitelist,blacklist=[],radius=32*32,longDistance=true,size=new Vec3(1, 1, 1),count=1}={}) => {\n    const players = (typeof whitelist != 'undefined' ? (whitelist instanceof Array ? whitelist : [whitelist]) : serv.getNearby({\n      world: world,\n      position: position.scaled(32).floored(),\n      radius: radius // 32 blocks, fixed position\n    }));\n\n    serv._writeArray('world_particles', {\n      particleId: particle,\n      longDistance: longDistance,\n      x: position.x,\n      y: position.y,\n      z: position.z,\n      offsetX: size.x,\n      offsetY: size.y,\n      offsetZ: size.z,\n      particleData: 1.0,\n      particles: count,\n      data: []\n    }, players.filter(p => blacklist.indexOf(p) == -1));\n  }\n};\n\nmodule.exports.player=function(player,serv){\n  player.commands.add({\n    base: 'particle',\n    info: 'emit a particle at a position',\n    usage: '/particle <id> [amount] [<sizeX> <sizeY> <sizeZ>]',\n    op: true,\n    parse(str) {\n      const results=str.match(/(\\d+)(?: (\\d+))?(?: (\\d+))?(?: (\\d+))?(?: (\\d+))?(?: (\\d+))?/);\n      if(!results) return false;\n      return {\n        particle:parseInt(results[1]),\n        amount:results[2] ? parseInt(results[2]) : 1,\n        size:results[5] ? new Vec3(parseInt(results[3]), parseInt(results[4]), parseInt(results[5])) : new Vec3(1, 1, 1)\n      };\n    },\n    action({particle,amount,size}) {\n      if (amount >= 100000) {\n        player.chat('You cannot emit more than 100,000 particles!');\n        return;\n      }\n      player.chat('Emitting \"' + particle + '\" (count: ' + amount + ', size: ' + size.toString() + ')');\n      serv.emitParticle(particle, player.world, player.position.scaled(1/32), {count: amount,size: size});\n    }\n  });\n};"],"sourceRoot":"/source/"}