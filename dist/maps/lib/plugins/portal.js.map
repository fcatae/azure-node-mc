{"version":3,"sources":["lib/plugins/portal.js"],"names":[],"mappings":"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","file":"lib/plugins/portal.js","sourcesContent":["const {detectFrame,generatePortal,addPortalToWorld}=require(\"flying-squid\").portal_detector;\nconst Vec3 = require(\"vec3\").Vec3;\nconst UserError=require(\"flying-squid\").UserError;\n\nmodule.exports.player=function(player,serv) {\n  player.use_flint_and_steel=async (referencePosition,direction,position) => {\n    let block=await player.world.getBlock(referencePosition);\n    if(block.name==\"obsidian\")\n    {\n      const frames=await detectFrame(player.world,referencePosition,direction);\n      if(frames.length!=0) {\n        const air = frames[0].air;\n        air.forEach(pos => player.setBlock(pos, 90, (frames[0].bottom[0].x - frames[0].bottom[1].x) != 0 ? 1 : 2));\n        player.world.portals.push(frames[0]);\n        return;\n      }\n    }\n    player.changeBlock(position, 51, 0);\n  };\n\n  player.on(\"dug\",({position,block}) => {\n\n    function destroyPortal(portal,positionAlreadyDone=null)\n    {\n      player.world.portals=player.world.portals.splice(player.world.portals.indexOf(portal),1);\n      portal\n        .air\n        .filter(ap => positionAlreadyDone==null || !ap.equals(positionAlreadyDone))\n        .forEach(ap => serv.setBlock(player.world,ap,0,0));\n    }\n\n    if(block.name==\"obsidian\")\n    {\n      const p=player.world.portals.filter(({bottom,top,left,right}) =>\n        [].concat.apply([], [bottom, left, right,top])\n          .reduce((acc,pos) => acc || pos.equals(position),false));\n      p.forEach(portal => destroyPortal(portal,position));\n    }\n\n    if(block.name==\"portal\")\n    {\n      const p=player.world.portals.filter(({air}) => air.reduce((acc,pos) => acc || pos.equals(position),false));\n      p.forEach(portal => destroyPortal(portal,position));\n    }\n  });\n\n\n\n  player.commands.add({\n    base: 'portal',\n    info: 'Create a portal frame',\n    usage: '/portal <bottomLeft:<x> <y> <z>> <direction:x|z> <width> <height>',\n    op: true,\n    parse(str) {\n      const pars=str.split(' ');\n      if(pars.length!=6)\n        return false;\n      let [x,y,z,direction,width,height]=pars;\n      [x,y,z] = [x,y,z].map((val, i) => serv.posFromString(val, player.position[['x','y','z'][i]] / 32));\n      const bottomLeft=new Vec3(x,y,z);\n      if(direction!=\"x\" && direction!=\"z\")\n        throw new UserError('Wrong Direction');\n      direction=direction=='x' ? new Vec3(1,0,0) : new Vec3(0,0,1);\n      return {bottomLeft,direction,width,height};\n    },\n    async action({bottomLeft,direction,width,height}) {\n      const portal=generatePortal(bottomLeft,direction,width,height);\n      await addPortalToWorld(player.world,portal,[],[],async (pos,type) => {\n        await serv.setBlock(player.world,pos,type,0);\n      });\n    }\n  });\n\n};"],"sourceRoot":"/source/"}